<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>人生ゲーム - α1</title>
  <style>
    :root {
      --board-cols: 8;   /* 横のマス数 */
      --board-rows: 5;   /* 縦のマス数 */
      --cell-size: 68px; /* マスの基本サイズ */
      --accent: #ff6b6b;
      --bg: #fffaf0;
      --text: #222;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color: var(--text);
      background: var(--bg);
      display: grid;
      place-items: center;
      min-height: 100vh;
      padding: 16px;
    }
    .container {
      width: min(100%, 1000px);
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 16px;
    }
    @media (max-width: 860px) {
      .container { grid-template-columns: 1fr; }
    }
    header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    header h1 {
      font-size: 1.6rem;
      margin: 0;
    }
    header .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
    }
    button.primary {
      background: var(--accent);
      color: #fff;
      border-color: transparent;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Board */
    .board {
      background: #fff;
      border: 2px solid #eee;
      border-radius: 12px;
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(var(--board-cols), minmax(52px, var(--cell-size)));
      grid-template-rows: repeat(var(--board-rows), minmax(52px, var(--cell-size)));
      gap: 8px;
      position: relative;
    }
    .cell {
      background: #f9fafb;
      border: 1px solid #e6e8eb;
      border-radius: 10px;
      padding: 6px;
      display: grid;
      place-items: center;
      font-size: 12px;
      position: relative;
      overflow: hidden;
    }
    .cell.start { background: #d1f7c4; }
    .cell.goal  { background: #cde7ff; }
    .cell.event { background: #fff4cc; }
    .cell.penalty { background: #ffe0e0; }
    .cell.bonus { background: #e8ffea; }

    .cell .idx {
      position: absolute;
      top: 4px; left: 6px;
      font-size: 10px; color: #999;
    }

    /* Player token */
    .token {
      width: 28px; height: 28px;
      border-radius: 50%;
      border: 2px solid #333;
      background: var(--accent);
      display: grid;
      place-items: center;
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: transform 240ms ease;
    }

    /* Sidebar */
    .sidebar {
      background: #fff;
      border: 2px solid #eee;
      border-radius: 12px;
      padding: 12px;
      display: grid;
      gap: 12px;
      height: fit-content;
    }
    .stat {
      display: flex; justify-content: space-between; gap: 8px;
      padding: 8px 10px; background: #f5f7fa; border-radius: 10px;
    }
    .log {
      border: 1px solid #eee;
      border-radius: 10px;
      background: #fafcff;
      padding: 10px;
      height: 220px;
      overflow: auto;
      font-size: 13px;
      line-height: 1.4;
    }
    .log p { margin: 0 0 6px; }
    .footer {
      font-size: 12px; color: #777;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>人生ゲーム（最小版）</h1>
      <div class="controls">
        <button id="btn-start" class="primary">ゲーム開始</button>
        <button id="btn-roll" disabled>サイコロを振る</button>
        <button id="btn-reset">リセット</button>
      </div>
    </header>

    <main class="board" id="board"></main>

    <aside class="sidebar">
      <div class="stat"><span>ターン</span><strong id="stat-turn">0</strong></div>
      <div class="stat"><span>位置</span><strong id="stat-pos">0</strong></div>
      <div class="stat"><span>所持金</span><strong id="stat-money">¥0</strong></div>

      <div class="log" id="log"></div>
      <div class="footer">サイコロ: 1〜6 の乱数。イベントはマスの定義に基づいて発生。</div>
    </aside>
  </div>

  <script>
    // --- ゲームデータ定義 -----------------------------------------------------
    // 盤面は行列で敷き詰めるが、実際の移動は「蛇行（ジグザグ）」で1次元インデックスを進める
    const BOARD_COLS = 8;
    const BOARD_ROWS = 5;
    const TOTAL_CELLS = BOARD_COLS * BOARD_ROWS;

    // マスのイベント定義
    // type: "none" | "bonus" | "penalty" | "event" | "start" | "goal"
    // effect: moneyの増減、skipTurnなどを記述可能
    const cells = Array.from({ length: TOTAL_CELLS }, (_, i) => ({
      index: i,
      type: "none",
      label: ""
    }));

    // スタートとゴール
    cells[0] = { index: 0, type: "start", label: "スタート" };
    cells[TOTAL_CELLS - 1] = { index: TOTAL_CELLS - 1, type: "goal", label: "ゴール" };

    // 適当にイベントを配置（後で自由に調整可能）
    const eventIndices = [3, 6, 9, 12, 15, 18, 23, 27, 31, 33];
    eventIndices.forEach(i => {
      cells[i].type = "event";
      cells[i].label = "イベント";
    });

    const bonusIndices = [4, 10, 16, 22, 30];
    bonusIndices.forEach(i => {
      cells[i].type = "bonus";
      cells[i].label = "ボーナス";
    });

    const penaltyIndices = [8, 14, 20, 26, 34];
    penaltyIndices.forEach(i => {
      cells[i].type = "penalty";
      cells[i].label = "ペナルティ";
    });

    // イベント効果テーブル（簡易版）
    const eventTable = [
      { text: "就職おめでとう！初任給で+¥30,000", money: +30000 },
      { text: "家賃の更新で-¥20,000", money: -20000 },
      { text: "副業がバズって+¥50,000", money: +50000 },
      { text: "スマホが壊れて-¥15,000", money: -15000 },
      { text: "推し活で-¥10,000", money: -10000 },
      { text: "奨学金が振り込まれた+¥40,000", money: +40000 },
      { text: "バイト昇給で+¥8,000", money: +8000 },
      { text: "体調不良で病院代-¥5,000", money: -5000 },
      { text: "フリマで売れて+¥6,000", money: +6000 },
      { text: "交通違反で-¥12,000", money: -12000 },
    ];

    // --- ゲーム状態 -----------------------------------------------------------
    const state = {
      started: false,
      turn: 0,
      position: 0,   // cells index
      money: 0,
      skipTurn: false,
      finished: false
    };

    // --- ユーティリティ -------------------------------------------------------
    const $ = sel => document.querySelector(sel);
    const boardEl = $("#board");
    const logEl = $("#log");
    const statTurnEl = $("#stat-turn");
    const statPosEl = $("#stat-pos");
    const statMoneyEl = $("#stat-money");
    const btnStart = $("#btn-start");
    const btnRoll = $("#btn-roll");
    const btnReset = $("#btn-reset");

    function yen(n) {
      return "¥" + n.toLocaleString("ja-JP");
    }

    function appendLog(text) {
      const p = document.createElement("p");
      p.textContent = text;
      logEl.appendChild(p);
      logEl.scrollTop = logEl.scrollHeight;
    }

    // 1次元インデックス → グリッド座標（蛇行）
    function indexToGrid(index) {
      const row = Math.floor(index / BOARD_COLS);
      let col = index % BOARD_COLS;
      // 偶数行は左→右、奇数行は右→左に蛇行
      if (row % 2 === 1) {
        col = BOARD_COLS - 1 - col;
      }
      return { row, col };
    }

    // --- 盤面描画 -------------------------------------------------------------
    function renderBoard() {
      boardEl.style.setProperty("--board-cols", BOARD_COLS);
      boardEl.style.setProperty("--board-rows", BOARD_ROWS);

      boardEl.innerHTML = "";
      cells.forEach(cell => {
        const div = document.createElement("div");
        div.className = "cell " + (cell.type !== "none" ? cell.type : "");
        div.dataset.index = String(cell.index);

        const idx = document.createElement("div");
        idx.className = "idx";
        idx.textContent = String(cell.index);
        div.appendChild(idx);

        const label = document.createElement("div");
        label.textContent = cell.label || "";
        div.appendChild(label);

        // CSS Gridで座標を指定
        const { row, col } = indexToGrid(cell.index);
        div.style.gridRowStart = row + 1;
        div.style.gridColumnStart = col + 1;

        boardEl.appendChild(div);
      });

      // プレイヤートークン
      const token = document.createElement("div");
      token.className = "token";
      token.id = "token";
      token.textContent = "P";
      boardEl.appendChild(token);
      placeToken(state.position);
    }

    function placeToken(index) {
      const targetCell = boardEl.querySelector(`.cell[data-index="${index}"]`);
      const token = $("#token");
      if (!targetCell || !token) return;

      // Tokenの位置をそのセルの中央に絶対配置する
      const rectParent = boardEl.getBoundingClientRect();
      const rectCell = targetCell.getBoundingClientRect();
      const x = rectCell.left - rectParent.left + rectCell.width / 2;
      const y = rectCell.top - rectParent.top + rectCell.height / 2;
      token.style.position = "absolute";
      token.style.transform = `translate(${x - 14}px, ${y - 14}px)`; // 半径分引いて中央へ
    }

    // --- イベント処理 ---------------------------------------------------------
    function resolveCell(index) {
      const cell = cells[index];
      if (!cell) return;

      switch (cell.type) {
        case "start":
          appendLog("スタート！がんばろう！");
          break;
        case "goal":
          appendLog("ゴール！お疲れさま！");
          state.finished = true;
          btnRoll.disabled = true;
          break;
        case "bonus": {
          const amount = [5000, 8000, 10000, 15000, 20000][Math.floor(Math.random() * 5)];
          state.money += amount;
          appendLog(`ボーナス！${yen(amount)}獲得`);
          break;
        }
        case "penalty": {
          const amount = [5000, 8000, 10000, 15000, 20000][Math.floor(Math.random() * 5)];
          state.money -= amount;
          appendLog(`ペナルティ…${yen(amount)}失う`);
          break;
        }
        case "event": {
          const ev = eventTable[Math.floor(Math.random() * eventTable.length)];
          state.money += ev.money;
          appendLog(`${ev.text}（残高: ${yen(state.money)}）`);
          // 稀に次ターンスキップ
          if (Math.random() < 0.1) {
            state.skipTurn = true;
            appendLog("次のターンはお休み（スキップ）");
          }
          break;
        }
        default:
          // none
          break;
      }
    }

    // --- 入力系 ---------------------------------------------------------------
    btnStart.addEventListener("click", () => {
      if (state.started) return;
      state.started = true;
      state.turn = 1;
      state.position = 0;
      state.money = 20000; // 初期資金
      state.finished = false;
      state.skipTurn = false;
      appendLog("ゲーム開始！初期資金: " + yen(state.money));
      btnRoll.disabled = false;
      renderBoard();
      updateStats();
    });

    btnRoll.addEventListener("click", () => {
      if (!state.started || state.finished) return;
      if (state.skipTurn) {
        appendLog("ターンをスキップします");
        state.skipTurn = false;
        state.turn += 1;
        updateStats();
        return;
      }

      const dice = Math.floor(Math.random() * 6) + 1; // 1..6
      appendLog(`サイコロ: ${dice}`);
      let nextPos = state.position + dice;
      if (nextPos >= TOTAL_CELLS - 1) {
        nextPos = TOTAL_CELLS - 1;
      }
      state.position = nextPos;
      placeToken(state.position);
      resolveCell(state.position);
      state.turn += 1;
      updateStats();
    });

    btnReset.addEventListener("click", () => {
      state.started = false;
      state.turn = 0;
      state.position = 0;
      state.money = 0;
      state.skipTurn = false;
      state.finished = false;
      btnRoll.disabled = true;
      logEl.innerHTML = "";
      renderBoard();
      updateStats();
    });

    function updateStats() {
      statTurnEl.textContent = String(state.turn);
      statPosEl.textContent = String(state.position);
      statMoneyEl.textContent = yen(state.money);
    }

    // 初期描画
    renderBoard();

    // リサイズ時にトークンの位置を再計算（レスポンシブ対応）
    window.addEventListener("resize", () => placeToken(state.position));
  </script>
</body>
</html>
